<?xml version="1.0" encoding="UTF-8"?>
<SunopsisExport>
<Admin RepositoryVersion="05.02.02.09" IsLegacyIdCompatible="false" />
<Encryption algorithm="AES" keyLength="128" exportKeyHash="" keyVect="mK79f+O0QCLgJFIJaqP02Q==" exportKeySalt="61089203-2302-451d-aa10-850dd4d2ee5b" containsCipherText="false"/>
<Object class="com.sunopsis.dwg.dbobj.SnpTrt">
		<Field name="CleanupOnError" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="CompType" type="java.lang.String">null</Field>
	<Field name="DelegateClass" type="java.lang.String">null</Field>
	<Field name="DelegateScript" type="java.lang.String">null</Field>
	<Field name="ExpectedAstClass" type="java.lang.String">null</Field>
	<Field name="ExtVersion" type="java.lang.String">null</Field>
	<Field name="FirstDate" type="java.sql.Timestamp"><![CDATA[2022-05-09 16:52:55.0]]></Field>
	<Field name="FirstUser" type="java.lang.String"><![CDATA[ADMINSPA]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[aeb51dac-f545-4992-9d10-a448e6da41c4]]></Field>
	<Field name="IndChange" type="java.lang.String"><![CDATA[I]]></Field>
	<Field name="IndExcludeExUnitBegin" type="java.lang.String">null</Field>
	<Field name="IndExcludeExUnitEnd" type="java.lang.String">null</Field>
	<Field name="IndExcludeExUnitMain" type="java.lang.String">null</Field>
	<Field name="IndExcludeMapBegin" type="java.lang.String">null</Field>
	<Field name="IndExcludeMapCleanup" type="java.lang.String">null</Field>
	<Field name="IndExcludeMapEnd" type="java.lang.String">null</Field>
	<Field name="IndGenerateLoad" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndIsHidden" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndJrnMethod" type="java.lang.String"><![CDATA[S]]></Field>
	<Field name="IndSuppSetBased" type="java.lang.String">null</Field>
	<Field name="IntgType" type="java.lang.String">null</Field>
	<Field name="IntVersion" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="IsConcurrent" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IsSeeded" type="java.lang.String">null</Field>
	<Field name="IBaseCompKm" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IFolder" type="com.sunopsis.sql.DbInt"><![CDATA[243]]></Field>
	<Field name="IProject" type="com.sunopsis.sql.DbInt"><![CDATA[84]]></Field>
	<Field name="IScBaseTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IScOrigTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IScTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1356]]></Field>
	<Field name="ITxtDelTxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtTrtTxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KimMultiDserver" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="KmDefault" type="java.lang.String">null</Field>
	<Field name="KmLang" type="java.lang.String">null</Field>
	<Field name="KmSrcLang" type="java.lang.String">null</Field>
	<Field name="KmSrcTechno" type="java.lang.String">null</Field>
	<Field name="KmTechno" type="java.lang.String">null</Field>
	<Field name="KmVersion" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp"><![CDATA[2022-05-09 16:52:55.0]]></Field>
	<Field name="LastUser" type="java.lang.String"><![CDATA[ADMINSPA]]></Field>
	<Field name="LkmType" type="java.lang.String">null</Field>
	<Field name="LChecksum" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LCode" type="java.lang.String">null</Field>
	<Field name="OggJkm" type="java.lang.String">null</Field>
	<Field name="OrdFolder" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ProcType" type="java.lang.String">null</Field>
	<Field name="ProdAstType" type="java.lang.String">null</Field>
	<Field name="RepGuid" type="java.lang.String">null</Field>
	<Field name="RepVersion" type="java.lang.String">null</Field>
	<Field name="ScriptPath" type="java.lang.String">null</Field>
	<Field name="ScOrigTrtTag" type="java.lang.String">null</Field>
	<Field name="Subtype" type="java.lang.String">null</Field>
	<Field name="TrtName" type="java.lang.String"><![CDATA[PR_008_EXTRAE_MAESTRAS]]></Field>
	<Field name="TrtType" type="java.lang.String"><![CDATA[U]]></Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
	<Field name="VLastDate" type="java.sql.Timestamp">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLanguage" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[ORC_PARAMETROS]]></Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[18114]]></Field>
	<Field name="DefLanguage" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[JYTHON]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp"><![CDATA[2022-05-09 16:52:55.0]]></Field>
	<Field name="FirstUser" type="java.lang.String"><![CDATA[ADMINSPA]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[340a959e-8499-4e1e-90ba-58bc06073c05]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[4515]]></Field>
	<Field name="IRefLineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IRefTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1356]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp"><![CDATA[2022-05-09 16:52:55.0]]></Field>
	<Field name="LastUser" type="java.lang.String"><![CDATA[ADMINSPA]]></Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[EXTRAE DATOS AMESTRAS ]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String">null</Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[007c85fb-a917-4dda-8042-20d6c1bc2f57]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[18114]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[import java.lang as lang
import java.sql as sql
import oracle.jdbc.OracleResultSet as OracleResultSet
import oracle.jdbc.OracleTypes as OracleTypes
import re
sourceConnection = odiRef.getJDBCConnectionFromLSchema("""ORC_BSCSPROD_ODI""") #"""PRY_FABR_DIG.V_002_CONEXION_SAC"""  ORC_BSCSPROD_ODI
targetConnection = odiRef.getJDBCConnectionFromLSchema("""ORC_PARAMETROS""") #"""PRY_FABR_DIG.V_002_CONEXION_DESTINO""" --> resultado del metodo de sustitucion ORC_PARAMETROS
targetConnection.setAutoCommit(0)
targetRead = targetConnection.prepareCall("""BEGIN OPEN ?
                                              FOR
                                                SELECT 
                                                     MAESTRA
                                                FROM MINTIC_MAESTRAS_TB
                                                WHERE BAN_CONSULTA = 0;                               
                                              END;""")
targetRead.setFetchSize(1000)
targetMerge = targetConnection.prepareStatement(""" MERGE INTO MINTIC_MAESTRAS_TB C
                                                    USING (SELECT 
                                                             '#PRY_FABR_DIG.V_008_CALC_MAESTRA' MAESTRA,
                                                             ? CANT_LINEAS,
                                                             ? CANT_DISPONIBLE,
                                                             ? CANT_MAX_MAESTRA,
                                                             ? S_N_COD_SAL,
                                                             ? S_V_MSJ_SAL
                                                           FROM DUAL) E
                                                    ON (C.MAESTRA = E.MAESTRA)
                                                      WHEN MATCHED THEN
                                                      UPDATE SET C.BAN_CONSULTA = 1
                                                      ,C.CANT_LINEAS = E.CANT_LINEAS
                                                      ,C.CANT_DISPONIBLE = E.CANT_DISPONIBLE
                                                      ,C.CANT_MAX_MAESTRA = E.CANT_MAX_MAESTRA
                                                      ,C.FEC_CONSULTA = SYSDATE""")

try:
	bloque = 20
	haydatos =0
	targetRead.registerOutParameter(1,OracleTypes.CURSOR)
	targetRead.execute()
	cursorSacRs =targetRead.getCursor(1)
	selectCursor = ''
	dato = 0
	while (cursorSacRs.next()):
		dato +=1
		if dato > 1:
			selectCursor += " UNION ALL "
		selectCursor += "SELECT  %s FROM DUAL " % (cursorSacRs.getString(1))#,cursorSacRs.getString(2)
        #ejecuta llamado a SAC
	#raise( str(selectCursor))
	procedureLanza =   """DECLARE S_N_CANT_ACT_SUS NUMBER; S_N_CANT_DISPONIBLE NUMBER; S_N_CANT_SUB_MAX NUMBER; S_N_COD_SAL NUMBER; S_V_MSJ_SAL VARCHAR2(255); BEGIN SYSADM.PKG_MINTIC.PRC_CONSULTA_SUB_MAESTRAS( '#PRY_FABR_DIG.V_008_CALC_MAESTRA','S',?,?,?,?,?); END;"""                                                                                    
	sourceRead = sourceConnection.prepareCall(procedureLanza)
	#raise (str(sourceRead))
        sourceRead.registerOutParameter(1, OracleTypes.NUMBER)
	sourceRead.registerOutParameter(2, OracleTypes.NUMBER)
        sourceRead.registerOutParameter(3, OracleTypes.NUMBER)
        sourceRead.registerOutParameter(4, OracleTypes.NUMBER)
        sourceRead.registerOutParameter(5, OracleTypes.VARCHAR)

	sourceRead.execute()
	targetMerge.setString(1, sourceRead.getString(1))
	targetMerge.setString(2, sourceRead.getString(2))
	targetMerge.setString(3, sourceRead.getString(3))
        targetMerge.setString(4, sourceRead.getString(4))
        targetMerge.setString(5, sourceRead.getString(5))

	targetMerge.addBatch()
	haydatos +=1
        if haydatos % bloque ==0:
		targetMerge.executeBatch()
		targetConnection.commit()
		targetMerge.clearBatch()

	if haydatos > 0:
		targetMerge.executeBatch()
		targetConnection.commit()

finally:
	sourceConnection.close()
	targetConnection.close()]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpOrigTxt">
		<Field name="GlobalId" type="java.lang.String">null</Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="OrigineName" type="java.lang.String"><![CDATA[Target Technology]]></Field>
	<Field name="SnpsCol" type="java.lang.String"><![CDATA[DEF_I_TXT]]></Field>
	<Field name="SnpsTable" type="java.lang.String"><![CDATA[SNP_LINE_TRT]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLanguage" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[18115]]></Field>
	<Field name="DefLanguage" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[ORC_PARAMETROS]]></Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp"><![CDATA[2022-05-09 16:52:55.0]]></Field>
	<Field name="FirstUser" type="java.lang.String"><![CDATA[ADMINSPA]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[e29a23b5-44b2-4cb4-a81a-322ca7bcacaf]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[4516]]></Field>
	<Field name="IRefLineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IRefTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1356]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp"><![CDATA[2022-05-09 16:52:55.0]]></Field>
	<Field name="LastUser" type="java.lang.String"><![CDATA[ADMINSPA]]></Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[20]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[ACTUALIZA ACTIVACIONES]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String">null</Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[5a75d506-33a3-4c6a-b1d2-17b713061323]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[18115]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[MERGE INTO <%=odiRef.getObjectName("MINTIC_ACTIVACIONES_TB")%> T1
    USING (WITH QUERY1 AS(
                SELECT
                    MIN(NUM_CONSECUTIVO) AS VAL_MINIMO
                FROM <%=odiRef.getObjectName("MINTIC_ACTIVACIONES_TB")%> T1
                LEFT JOIN <%=odiRef.getObjectName("MINTIC_MAESTRAS_TB")%> T2
                ON (T1.TMCODE = CAST(T2.TMCODE AS VARCHAR2(100)) AND CONSECUTIVO = #PRY_FABR_DIG.V_008_CALC_MAEST_CONS)
                WHERE BAN_MAESTRA = 0
                AND T2.MAESTRA IS NOT NULL
                ), QUERY2 AS(
                SELECT
                    DISTINCT(CANT_DISPONIBLE-1) AS VAL_MAXIMO
                FROM <%=odiRef.getObjectName("MINTIC_ACTIVACIONES_TB")%> T1
                LEFT JOIN <%=odiRef.getObjectName("MINTIC_MAESTRAS_TB")%> T2
                ON (T1.TMCODE = CAST(T2.TMCODE AS VARCHAR2(100)) AND CONSECUTIVO = #PRY_FABR_DIG.V_008_CALC_MAEST_CONS)
                WHERE BAN_MAESTRA = 0
                AND T2.MAESTRA IS NOT NULL
                AND ROWNUM = 1
                ), QUERY3 AS(
                SELECT
                     T1.NUM_CONSECUTIVO
                    ,T1.CODMIN
                    ,T2.MAESTRA
                    ,T2.CANT_MAX_MAESTRA
                FROM <%=odiRef.getObjectName("MINTIC_ACTIVACIONES_TB")%> T1
                LEFT JOIN <%=odiRef.getObjectName("MINTIC_MAESTRAS_TB")%> T2
                ON (T1.TMCODE = CAST(T2.TMCODE AS VARCHAR2(100)) AND CONSECUTIVO = #PRY_FABR_DIG.V_008_CALC_MAEST_CONS)
                WHERE BAN_MAESTRA = 0
                ), QUERY4 AS(
                /*SELECT
                     COUNT(T1.BAN_MAESTRA) TOTAL_CARGADAS
                FROM <%=odiRef.getObjectName("MINTIC_ACTIVACIONES_TB")%> T1
                LEFT JOIN <%=odiRef.getObjectName("MINTIC_MAESTRAS_TB")%> T2
                ON (T1.TMCODE = CAST(T2.TMCODE AS VARCHAR2(100)) AND CONSECUTIVO = #PRY_FABR_DIG.V_008_CALC_MAEST_CONS)
                JOIN <%=odiRef.getObjectName("MINTIC_INFO_DUPLAS_TB")%> T3
                ON (T1.CODMIN = T3.MIN)
                WHERE BAN_MAESTRA = #PRY_FABR_DIG.V_008_CALC_MAEST_CONS
                AND T3.SK_ESTADO_BENEFI IN (1,3,10,6,11,4)*/
                SELECT
                    SUM(TOTAL_CARGADAS) AS TOTAL_CARGADAS
                FROM(
                SELECT
                    DISTINCT(CANT_LINEAS) AS TOTAL_CARGADAS
                FROM <%=odiRef.getObjectName("MINTIC_ACTIVACIONES_TB")%> T1
                LEFT JOIN <%=odiRef.getObjectName("MINTIC_MAESTRAS_TB")%> T2
                ON (T1.TMCODE = CAST(T2.TMCODE AS VARCHAR2(100)) AND CONSECUTIVO = #PRY_FABR_DIG.V_008_CALC_MAEST_CONS)
                WHERE BAN_MAESTRA = 0
                AND T2.MAESTRA IS NOT NULL
                AND ROWNUM = 1
                UNION 
                SELECT
                    COUNT(BAN_MAESTRA) AS COU_MAESTRA
                FROM <%=odiRef.getObjectName("MINTIC_ACTIVACIONES_TB")%> T1
                LEFT JOIN <%=odiRef.getObjectName("MINTIC_MAESTRAS_TB")%> T2
                ON (T1.TMCODE = CAST(T2.TMCODE AS VARCHAR2(100)) AND CONSECUTIVO = #PRY_FABR_DIG.V_008_CALC_MAEST_CONS)
                JOIN <%=odiRef.getObjectName("MINTIC_INFO_DUPLAS_TB")%> T3
                ON (T1.CODMIN = T3.MIN)
                WHERE BAN_MAESTRA = #PRY_FABR_DIG.V_008_CALC_MAEST_CONS
                AND T3.SK_ESTADO_BENEFI IN (6,11,4))
                )
                SELECT 
                  CASE
                    WHEN QUERY4.TOTAL_CARGADAS = QUERY2.VAL_MAXIMO+1 THEN NULL
                    ELSE QUERY3.NUM_CONSECUTIVO END NUM_CONSECUTIVO
                 ,CASE
                    WHEN QUERY4.TOTAL_CARGADAS = QUERY2.VAL_MAXIMO+1 THEN NULL
                    ELSE QUERY3.CODMIN END CODMIN
                  ,CASE
                    WHEN QUERY4.TOTAL_CARGADAS = QUERY2.VAL_MAXIMO+1 THEN NULL
                    ELSE QUERY3.MAESTRA END MAESTRA
                 ,CASE
                    WHEN QUERY4.TOTAL_CARGADAS = QUERY2.VAL_MAXIMO+1 THEN NULL
                    ELSE (CASE 
                            WHEN QUERY3.MAESTRA > '0' THEN '1' ELSE '2' END) END AS RMIN
                FROM QUERY1
                    ,QUERY2
                    ,QUERY3
                    ,QUERY4
               --WHERE QUERY3.NUM_CONSECUTIVO BETWEEN QUERY1.VAL_MINIMO AND QUERY1.VAL_MINIMO+QUERY2.VAL_MAXIMO
               WHERE QUERY3.NUM_CONSECUTIVO BETWEEN QUERY1.VAL_MINIMO AND QUERY1.VAL_MINIMO + (QUERY3.CANT_MAX_MAESTRA - QUERY4.TOTAL_CARGADAS)-1
                GROUP BY 
                 CASE
                    WHEN QUERY4.TOTAL_CARGADAS = QUERY2.VAL_MAXIMO+1 THEN NULL
                    ELSE QUERY3.NUM_CONSECUTIVO END 
                 ,CASE
                    WHEN QUERY4.TOTAL_CARGADAS = QUERY2.VAL_MAXIMO+1 THEN NULL
                    ELSE QUERY3.CODMIN END 
                  ,CASE
                    WHEN QUERY4.TOTAL_CARGADAS = QUERY2.VAL_MAXIMO+1 THEN NULL
                    ELSE QUERY3.MAESTRA END 
                 ,CASE
                    WHEN QUERY4.TOTAL_CARGADAS = QUERY2.VAL_MAXIMO+1 THEN NULL
                    ELSE (CASE 
                            WHEN QUERY3.MAESTRA > '0' THEN '1' ELSE '2' END) END) T2
    ON (T1.CODMIN = T2.CODMIN)
  WHEN MATCHED THEN
    UPDATE SET T1.BAN_MAESTRA = #PRY_FABR_DIG.V_008_CALC_MAEST_CONS
              ,T1.COLGAR_A_MAESTRA = REPLACE(T2.MAESTRA,',','.')
              ,T1.RMIN = T2.RMIN
    WHERE T2.MAESTRA IS NOT NULL]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_FOLDER.243]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[69305596-6e7b-4199-a1d2-56acb6e13bb8]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[PRY_FABR_DIG.008_MOVIL_REPORTE_MINTIC]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_PROJECT.SNP_FOLDER]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[12.24]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_PROJECT.84]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[efab427f-820e-49b2-b11d-10e598c79be6]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[PRY_FABR_DIG]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_PROJECT]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[12]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.18114]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[007c85fb-a917-4dda-8042-20d6c1bc2f57]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TRT.1356]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[aeb51dac-f545-4992-9d10-a448e6da41c4]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[PRY_FABR_DIG.PR_008_EXTRAE_MAESTRAS]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_PROJECT.SNP_TRT]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[12.22]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.18115]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[5a75d506-33a3-4c6a-b1d2-17b713061323]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_ORIGTXT.102]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String">null</Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.DwgExportSummary">
		<Field name="ExpTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="InstObjNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="JoinColNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="JoinNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="KeyColNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="KeyNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="LinkDiagNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="MorigTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="MtxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OrigTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
	<Field name="OtherObjectsNb" type="com.sunopsis.sql.DbInt"><![CDATA[3]]></Field>
	<Field name="PlanAgentNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="StepNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="TxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
	<Field name="UeOrigNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="UeUsedNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="VarPlanAgentNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OdiVersion" type="java.lang.String"><![CDATA[12.2.1]]></Field>
	<Field name="OriginRepositoryID" type="com.sunopsis.sql.DbInt"><![CDATA[11]]></Field>
	<Field name="RepositoryVersion" type="java.lang.String"><![CDATA[05.02.02.09]]></Field>
</Object>
</SunopsisExport>
